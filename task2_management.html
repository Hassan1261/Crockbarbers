<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaduna Electric Task Management System</title>
    <style>
        /* Advanced CSS Styling with White and Green Color Scheme */
        :root {
            --primary-green: #008000; /* Dark Green */
            --light-green: #90EE90; /* Light Green */
            --white: #FFFFFF;
            --gray: #F0F0F0;
            --text-color: #333333;
            --border-radius: 8px;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom right, var(--white), var(--light-green));
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url('https://www.technikum-wien.at/_next/image/?url=https%3A%2F%2Fmedia-hp.technikum-wien.at%2Fmedia%2F20221206101037%2FTitelbild_MLE_neu-1.jpg&w=3840&q=75');
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay; /* Blend gradient with background image */
        }

        .container {
            background: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 800px;
            width: 100%;
            margin: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        header img {
            width: 150px;
            height: auto;
        }

        h1, h2 {
            color: var(--primary-green);
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        input, select, textarea, button {
            padding: 10px;
            border: 1px solid var(--light-green);
            border-radius: var(--border-radius);
            font-size: 16px;
        }

        button {
            background: var(--primary-green);
            color: var(--white);
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #006400; /* Darker Green */
        }

        .hidden {
            display: none;
        }

        .task-list {
            margin-top: 20px;
        }

        .task-item {
            background: var(--gray);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .map-placeholder {
            height: 200px;
            background: var(--light-green);
            border-radius: var(--border-radius);
            text-align: center;
            line-height: 200px;
            margin-top: 10px;
        }

        /* Advanced Styling for Professional Look */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--light-green);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-card h3 {
            margin: 0;
            color: var(--primary-green);
        }

        /* Notification Style */
        #notifications {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            z-index: 1000;
        }

        .notification {
            background: var(--primary-green);
            color: var(--white);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container" id="login-container">
        <header>
            <img src="https://businesspost.ng/wp-content/uploads/2019/08/Kaduna-Electric-logo.png" alt="Kaduna Electric Logo">
            <h1>Kaduna Electric Task Management System</h1>
        </header>
        <form id="login-form">
            <label for="username">Username:</label>
            <input type="text" id="username" required>
            
            <label for="password">Password:</label>
            <input type="password" id="password" required>
            
            <label for="role">Role:</label>
            <select id="role" required>
                <option value="">Select Role</option>
                <option value="admin">Admin</option>
                <option value="supervisor">Supervisor</option>
                <option value="staff">Field Staff</option>
                <option value="auditor">Auditor</option>
            </select>
            
            <button type="submit">Login</button>
        </form>
    </div>

    <div class="container hidden" id="dashboard-container">
        <header>
            <img src="https://businesspost.ng/wp-content/uploads/2019/08/Kaduna-Electric-logo.png" alt="Kaduna Electric Logo">
            <h1>Welcome, <span id="user-role"></span></h1>
            <button id="logout">Logout</button>
        </header>

        <!-- Admin/Supervisor: Task Creation -->
        <div id="task-creation" class="hidden">
            <h2>Create New Task</h2>
            <form id="task-form">
                <label for="task-title">Task Title:</label>
                <input type="text" id="task-title" required>
                
                <label for="task-description">Description:</label>
                <textarea id="task-description" required></textarea>
                
                <label for="priority">Priority:</label>
                <select id="priority" required>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                    <option value="Emergency">Emergency</option>
                </select>
                
                <label for="due-date">Due Date:</label>
                <input type="datetime-local" id="due-date" required>
                
                <label for="location">Location (Address):</label>
                <input type="text" id="location" required>
                <button type="button" id="get-gps">Get Current GPS</button>
                <input type="hidden" id="gps-lat">
                <input type="hidden" id="gps-lon">
                
                <label for="assigned-to">Assigned To (Staff Username):</label>
                <input type="text" id="assigned-to" required>
                
                <label for="evidence-type">Evidence Type:</label>
                <select id="evidence-type" required>
                    <option value="Photo">Photo</option>
                    <option value="Video">Video</option>
                    <option value="Both">Both</option>
                </select>
                
                <button type="submit">Create Task</button>
            </form>
        </div>

        <!-- Task List for All Roles -->
        <div class="task-list">
            <h2>Tasks</h2>
            <div id="tasks"></div>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3>Tasks Assigned</h3>
                <p id="tasks-assigned">0</p>
            </div>
            <div class="stat-card">
                <h3>Tasks Completed</h3>
                <p id="tasks-completed">0</p>
            </div>
            <div class="stat-card">
                <h3>Average Completion Time</h3>
                <p id="avg-time">0 mins</p>
            </div>
        </div>

        <!-- Map Placeholder for Location Intelligence -->
        <div class="map-placeholder">Map View (Integrate Google Maps API here)</div>
    </div>

    <!-- Notifications -->
    <div id="notifications"></div>

    <script>
        // JavaScript for Functionality
        const ROLES = {
            admin: ['create', 'assign', 'verify', 'dashboard'],
            supervisor: ['create', 'assign', 'verify', 'dashboard'],
            staff: ['view', 'update', 'evidence'],
            auditor: ['view', 'audit']
        };

        let currentUser = null;
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notifications = [];

        // Helper Functions
        function showNotification(message) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.getElementById('notifications').appendChild(notif);
            setTimeout(() => notif.remove(), 5000);
            // Simulate SMS/Email
            console.log(`SMS/Email: ${message}`);
        }

        function updateDashboardStats() {
            const assigned = tasks.length;
            const completed = tasks.filter(t => t.status === 'Completed').length;
            const avgTime = tasks.reduce((sum, t) => sum + (t.completionTime || 0), 0) / (completed || 1);
            document.getElementById('tasks-assigned').textContent = assigned;
            document.getElementById('tasks-completed').textContent = completed;
            document.getElementById('avg-time').textContent = `${Math.round(avgTime)} mins`;
        }

        function renderTasks() {
            const tasksDiv = document.getElementById('tasks');
            tasksDiv.innerHTML = '';
            tasks.forEach((task, index) => {
                if (currentUser.role === 'staff' && task.assignedTo !== currentUser.username) return;
                const taskItem = document.createElement('div');
                taskItem.className = 'task-item';
                taskItem.innerHTML = `
                    <h3>${task.title}</h3>
                    <p>${task.description}</p>
                    <p>Priority: ${task.priority} | Due: ${task.dueDate} | Status: ${task.status || 'Assigned'}</p>
                    <p>Location: ${task.location} (GPS: ${task.gps || 'N/A'})</p>
                `;
                if (currentUser.role === 'staff') {
                    const statusSelect = document.createElement('select');
                    ['Assigned', 'Accepted', 'En-route', 'On-site', 'In progress', 'Completed', 'Rejected'].forEach(s => {
                        const opt = document.createElement('option');
                        opt.value = s;
                        opt.text = s;
                        opt.selected = s === (task.status || 'Assigned');
                        statusSelect.add(opt);
                    });
                    statusSelect.onchange = () => updateTaskStatus(index, statusSelect.value);
                    taskItem.appendChild(statusSelect);

                    if (task.evidenceType) {
                        const evidenceDiv = document.createElement('div');
                        evidenceDiv.innerHTML = `
                            <label>Upload Evidence (${task.evidenceType}):</label>
                            <input type="file" accept="${task.evidenceType === 'Video' ? 'video/*' : 'image/*'}" capture="environment">
                            <button onclick="uploadEvidence(${index})">Submit Evidence</button>
                        `;
                        taskItem.appendChild(evidenceDiv);
                    }
                }
                if (['admin', 'supervisor'].includes(currentUser.role)) {
                    const verifyBtn = document.createElement('button');
                    verifyBtn.textContent = 'Verify';
                    verifyBtn.onclick = () => verifyTask(index);
                    taskItem.appendChild(verifyBtn);
                }
                tasksDiv.appendChild(taskItem);
            });
        }

        function updateTaskStatus(index, status) {
            tasks[index].status = status;
            tasks[index].timestamp = new Date().toISOString();
            // Simulate Geo-fencing
            if (status === 'On-site') getGPS().then(gps => tasks[index].gps = gps);
            saveTasks();
            renderTasks();
            showNotification(`Task status updated to ${status}`);
        }

        function uploadEvidence(index) {
            // Simulate upload (in real app, use File API and store in localStorage or send to server)
            showNotification('Evidence uploaded successfully (simulated)');
            // For offline, use IndexedDB or localStorage for temp storage
        }

        function verifyTask(index) {
            const comment = prompt('Review Comment:');
            tasks[index].verified = true;
            tasks[index].comment = comment;
            saveTasks();
            renderTasks();
            showNotification('Task verified');
        }

        function getGPS() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(pos => {
                        resolve(`${pos.coords.latitude}, ${pos.coords.longitude}`);
                    }, err => reject(err));
                } else {
                    reject('Geolocation not supported');
                }
            });
        }

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            updateDashboardStats();
        }

        // Event Listeners
        document.getElementById('login-form').addEventListener('submit', e => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const role = document.getElementById('role').value;
            currentUser = { username, role };
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('dashboard-container').classList.remove('hidden');
            document.getElementById('user-role').textContent = role.charAt(0).toUpperCase() + role.slice(1);
            if (['admin', 'supervisor'].includes(role)) {
                document.getElementById('task-creation').classList.remove('hidden');
            }
            renderTasks();
            updateDashboardStats();
        });

        document.getElementById('task-form').addEventListener('submit', e => {
            e.preventDefault();
            const task = {
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                priority: document.getElementById('priority').value,
                dueDate: document.getElementById('due-date').value,
                location: document.getElementById('location').value,
                gps: `${document.getElementById('gps-lat').value}, ${document.getElementById('gps-lon').value}`,
                assignedTo: document.getElementById('assigned-to').value,
                evidenceType: document.getElementById('evidence-type').value,
                status: 'Assigned',
                createdAt: new Date().toISOString()
            };
            tasks.push(task);
            saveTasks();
            renderTasks();
            showNotification('New task created and assigned');
            e.target.reset();
        });

        document.getElementById('get-gps').addEventListener('click', () => {
            getGPS().then(gps => {
                const [lat, lon] = gps.split(', ');
                document.getElementById('gps-lat').value = lat;
                document.getElementById('gps-lon').value = lon;
                showNotification('GPS captured');
            }).catch(err => showNotification('Error getting GPS: ' + err.message));
        });

        document.getElementById('logout').addEventListener('click', () => {
            currentUser = null;
            document.getElementById('login-container').classList.remove('hidden');
            document.getElementById('dashboard-container').classList.add('hidden');
        });

        // Simulate Real-Time Tracking with Interval
        setInterval(() => {
            // Simulate updates or idle detection
            // In real app, use WebSockets or polling
        }, 5000);

        // Offline Mode Simulation: Use localStorage, sync when online (navigator.onLine)

        // For Maps: In real app, integrate Google Maps API
        // e.g., <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
        // Then initMap function

        // Audit Trail: Log actions in localStorage
        // Integrations: Simulated, in real app use APIs

        // Security: In real app, use HTTPS, tokens, etc.
    </script>
</body>
</html>